在做数据分析时，通常会遇到一类问题，就是针对特定维度做cube，或者做特定的维度钻取，这时最常用的方式就是计算出各个维度下的指标，然后做union的操作。那么union和union all有什么区别呢？
举个例子，比较以下两个语句和输出。


会发现，union操作会将两个查询的结果结合起来，并且做了去重操作，而union all操作是仅仅将两个查询的结果结合起来未做去重操作。union会进行重复值的扫描和进行去重，所以效率在数据量增大之后会变低，所以要谨慎使用。
针对这种对同一张表cube的问题，union all已经做了一些优化，做到只扫描一次源表，当然multi insert同样可以达到扫描一次源表，那么这两者效果对比如何？
依然看一个例子，选取了62亿左右的数据量，然后对比一下语句和运行时长。



运行时长显示union all的效率会更高，运行时长短，说明虽然两种方式都只扫描一次源表，但是multi insert在插入到多个分区时做了很多除了扫表外其他的事情。所以可以多用union all来解决类似的问题，当然如果有一些动态分区等特殊的业务场景，还是可以考虑用multi insert来解决。
